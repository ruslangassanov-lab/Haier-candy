name: Convert large SVG to WebP
on:
  push:
    branches: [main, master]
  workflow_dispatch:

jobs:
  convert:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Install ImageMagick
      run: sudo apt-get update && sudo apt-get install -y imagemagick
    
    - name: Find and convert large SVG
      run: |
        echo "üîç –ò—â–µ–º –±–æ–ª—å—à–∏–µ SVG —Ñ–∞–π–ª—ã (>500KB)..."
        find . -name "*.svg" -size +500k | while read svg_file; do
          webp_file="${svg_file%.svg}.webp"
          echo "–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º: $svg_file -> $webp_file"
          convert "$svg_file" -quality 85 "$webp_file"
        done
        
        echo "‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
        
    - name: List converted files
      run: find . -name "*.webp" -exec ls -lh {} \;