name: Optimize SVG
on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  optimize:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # ÐšÐ›Ð®Ð§Ð•Ð’ÐÐ¯ Ð¡Ð¢Ð ÐžÐšÐ - Ð´Ð°Ñ‘Ñ‚ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° Ð·Ð°Ð¿Ð¸ÑÑŒ
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install SVGO
      run: npm install -g svgo

    - name: Find and optimize all SVG files
      run: |
        echo "ðŸ” Ð˜Ñ‰ÐµÐ¼ SVG Ñ„Ð°Ð¹Ð»Ñ‹..."
        find . -name "*.svg" -type f > svg_files.txt
        count=$(wc -l < svg_files.txt)
        echo "ðŸ“Š ÐÐ°Ð¹Ð´ÐµÐ½Ð¾ Ñ„Ð°Ð¹Ð»Ð¾Ð²: $count"
        
        if [ $count -eq 0 ]; then
          echo "âœ… SVG Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾, Ð·Ð°Ð²ÐµÑ€ÑˆÐ°ÐµÐ¼"
          exit 0
        fi
        
        echo "âš™ï¸  ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼..."
        optimized=0
        while read -r file; do
          echo "  ðŸ“„ $file"
          if svgo "$file" --quiet; then
            optimized=$((optimized + 1))
          fi
        done < svg_files.txt
        
        echo "âœ… ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ñ„Ð°Ð¹Ð»Ð¾Ð²: $optimized Ð¸Ð· $count"

    - name: Commit and push if changed
      if: success()
      run: |
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÐµÑÑ‚ÑŒ Ð»Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ
        if [[ -z "$(git status --porcelain)" ]]; then
          echo "âœ… ÐÐµÑ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°"
          exit 0
        fi
        
        echo "ðŸ“¦ ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚..."
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add -A
        git commit -m "ðŸ”§ optimize: auto SVG optimization"
        
        echo "ðŸš€ ÐŸÑƒÑˆÐ¸Ð¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ..."
        git push